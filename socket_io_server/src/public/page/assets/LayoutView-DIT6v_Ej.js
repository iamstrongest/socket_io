import{u as S,s as f}from"./user-qb5UuSgt.js";import{u as b}from"./notify-C3hpjBAM.js";import{u as A,n as m,o as r,c as a,F as k,r as v,a as c,t as w,b as y,d as V,e as _,f as $,g as q,h as N,R as I}from"./index-Dtgv3Kdn.js";import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";const L=["onClick","title"],j={class:"icon","aria-hidden":"true"},B=["xlink:href"],P={key:0,class:"more-action"},z=["title","onClick"],R={class:"inner"},U={class:"more_icon"},F={class:"icon","aria-hidden":"true"},M=["xlink:href"],D={key:0,class:"notify"},E={__name:"LeftAside",setup(g){const p=A(),l=S(),d=b();function o(t,n){const{route:e,id:s}=t;n.stopPropagation(),s==4&&u(),d.updateAsideActive(s),e&&p.push(e)}const i=[{class:"#icon-tongzhi",route:"/notify",id:1,title:"系统通知"},{class:"#icon-liaotian",route:"/chat",id:2,title:"聊天记录"},{class:"#icon-haoyouliebiao",route:"/friend",id:3,title:"好友列表"},{class:"#icon-gengduox",id:4,title:"更多",children:[{class:"#icon-tianjiahaoyou",route:"/addfriend",id:5,title:"添加好友"},{class:"#icon-gerenzhongxin",route:"/user",id:6,title:"个人信息"},{class:"#icon-suoyouren",route:"/alluser",id:7,title:"注册列表"},{class:"#icon-tuichu",id:8,route:"/login",title:"退出登录"}]}];function u(){const t=document.querySelector(".more-action");m(()=>{t.style.display=t.style.display==="block"?"none":"block"})}function h(t){let{route:n,id:e}=t;const s=document.querySelector(".more-action");e==8&&(f.emit("logout",{id:l.user.info.id,username:l.user.info.username}),l.resetUserInfo(),localStorage.removeItem("token")),e==6&&(n=`${n}?id=${l.user.info.id}`),m(()=>{s.style.display="none"}),n&&p.push(n)}return window.onclick=function(t){const n=document.querySelector(".more-action");m(()=>{n.style.display="none"})},(t,n)=>(r(),a("aside",null,[(r(),a(k,null,v(i,e=>c("div",{class:V([{active:_(d).asideActive==e.id,popover:e.id==4},"common hover"]),key:e.id,onClick:s=>o({route:e.route,id:e.id},s),title:e.title},[(r(),a("svg",j,[c("use",{"xlink:href":e.class},null,8,B)])),e.id==4?(r(),a("div",P,[(r(!0),a(k,null,v(i[3].children,s=>(r(),a("div",{class:"popup-item hover",title:s.title,onClick:J=>h(s)},[c("div",R,[c("div",U,[(r(),a("svg",F,[c("use",{"xlink:href":s.class},null,8,M)]))]),c("span",null,w(s.title),1)])],8,z))),256))])):y("",!0)],10,L)),64)),_(d).notify.unreadNum?(r(),a("div",D,[n[0]||(n[0]=c("div",{class:"notify-icon"},[c("svg",{class:"icon","aria-hidden":"true"},[c("use",{"xlink:href":"#icon-hongdian"})])],-1)),c("span",null,w(_(d).notify.unreadNum),1)])):y("",!0)]))}},O=C(E,[["__scopeId","data-v-750a4f4a"]]);function x(){Notification.requestPermission().then(g=>{console.log(g==="granted"?"权限已授予，可以发送通知":g==="denied"?"权限被拒绝":"用户未做出选择")})}const T={key:0},G={class:"rightAise"},H={__name:"LayoutView",setup(g){const p=b(),l=S();function d(o){let i="";switch(o.type){case 1:i="系统通知";break;case 2:i="好友申请";break;case 3:i="申请反馈";break}p.addNotifiy(o);const u=new Notification(i,{body:o.conment,icon:"../assets/img/info.jpg"});u.onclick=()=>{window.focus()}}return $(async()=>{await l.setUserInfo(),await p.setNotifiy()}),q(()=>{f.on("friend_login",o=>{const i=new Notification("好友上线通知",{body:o.msg,icon:"../assets/img/info.jpg"});i.onclick=()=>{window.focus()},console.log(o.msg)}),f.on("friend_logout",o=>{const i=new Notification("好友下线通知",{body:o.msg,icon:"../assets/img/info.jpg"});i.onclick=()=>{window.focus()},console.log(o.msg)}),f.on("disconnect",()=>{console.log(f.connected)}),window.onload=()=>{Notification.permission!=="granted"&&x()},f.on("receive_notify",o=>{Notification.permission==="granted"?d(o):x()})}),(o,i)=>{var u,h,t;return(t=(h=(u=_(l))==null?void 0:u.user)==null?void 0:h.info)!=null&&t.id?(r(),a("main",T,[N(O),c("div",G,[N(_(I))])])):y("",!0)}}},Y=C(H,[["__scopeId","data-v-9866625c"]]);export{Y as default};
