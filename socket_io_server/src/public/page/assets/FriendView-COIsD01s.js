import{A as pe,r as c,w as Z,n as H,o as l,c as r,B as _e,a as o,f as A,l as ee,v as te,C as ge,u as he,g as ye,h as ke,i as we,j as Ce,d as K,q as xe,F,b,t as R,e as z,m as V,k as $,D as W,K as X}from"./index-DVw92pm9.js";import{_ as B,u as ne,g as Y,b as Ie,d as Fe,s as J}from"./_plugin-vue_export-helper-DsrsFqtt.js";import{N as be}from"./NoData-DaqeYu2V.js";import{u as Re}from"./notify-ju4UpO40.js";import{u as $e}from"./chat-BlAwU8ry.js";import{e as Ve,d as Ae,f as Le,i as G,h as Me}from"./group_chat-CzpvJGJe.js";import{A as Ne}from"./AddRoom-BvQenGit.js";const Se={__name:"Mask",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(x){const p=pe(x,"modelValue"),i=c();function k(u){u.stopPropagation(),p.value=!1}return Z(p,(u,d)=>{u===!0&&H(()=>{i.value.style.visibility="visible"}),u===!1&&H(()=>{i.value.style.visibility="hidden"})}),(u,d)=>(l(),r("div",{ref_key:"maskRef",ref:i,class:"mask",onClick:k},[_e(u.$slots,"default",{},()=>[d[0]||(d[0]=o("text",null,"暂无内容",-1))])],512))}},Q=B(Se,[["__scopeId","data-v-9d877ef1"]]),Ue={class:"form_col file"},De={for:"file",class:"flie_label"},Ge=["src"],ze={class:"form_col"},Be={for:"group_name"},je={__name:"AddGroupForm",props:{confirmFn:Function},setup(x){const p=c(),i=c(),k=c(null),u=x,d=async()=>{const f=new FormData,s=k.value.files[0];if(!(s&&/^(image\/jpeg|image\/png|image\/gif|image\/bmp|image\/webp)$/.test(s.type))){alert("Valid image file.");return}if(i.length==0){alert("群聊名称不能为空");return}f.append("file",s),f.append("fileName",s.name.split(".")[0]),f.append("timestamp",Date.now()),f.append("roomName",i.value);try{const _=await Ve(f),{data:w}=_;u.confirmFn&&u.confirmFn(w.data.roomId),i.value=""}catch(_){console.error("上传失败:",_)}},m=f=>{const s=f.target.files[0],h=new FileReader;h.onload=function(_){const w=_.target.result;p.value=w},h.readAsDataURL(s)},I=f=>{f.stopPropagation()};return(f,s)=>(l(),r("form",{onSubmit:ge(d,["prevent"]),onClick:I},[o("div",Ue,[o("label",De,[s[1]||(s[1]=o("span",null,"上传头像:",-1)),s[2]||(s[2]=o("div",null,[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-shangchuantouxiang"})])],-1)),o("input",{type:"file",name:"file",ref_key:"fileRef",ref:k,id:"file",onChange:m},null,544),p.value?(l(),r("img",{key:0,src:p.value,alt:"预览"},null,8,Ge)):A("",!0)])]),o("div",ze,[o("label",Be,[s[3]||(s[3]=o("span",null,"群聊名称: ",-1)),ee(o("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=h=>i.value=h),id:"group_name",name:"group_name",placeholder:"输入群聊名称"},null,512),[[te,i.value]])])]),s[4]||(s[4]=o("div",{class:"form_col submit"},[o("label",{for:"submit"},[o("button",{type:"submit",name:"submit",id:"submit"},"创建")])],-1))],32))}},Ee=B(je,[["__scopeId","data-v-699fb2e7"]]),Te={class:"search"},Pe=["onClick","onContextmenu"],Oe=["src"],qe=["title"],He=["onClick"],Ke={class:"more_icon"},We={class:"icon","aria-hidden":"true"},Xe=["xlink:href"],Ye=["onContextmenu","onClick"],Je=["src"],Qe=["title"],Ze=["onClick"],et={class:"more_icon"},tt={class:"icon","aria-hidden":"true"},nt=["xlink:href"],ot={__name:"FriendList",setup(x){const p=Re(),i=ne(),k=$e(),u=he(),d=c([]),m=c([]),I=c(),f=c(),s=c(null),h=c(),_=c(!1),w=c(!1),v=ye({selectId:"",username:"",avatar:""}),C=c(1),L=c(""),g=c([]);Z(L,(n,t)=>{n.length===0?C.value===1?g.value=d.value:g.value=m.value:C.value===1?g.value=d.value.filter(e=>e.username.indexOf(n)!==-1):g.value=m.value.filter(e=>e.roomName.indexOf(n)!==-1)});function j(n,t){p.updateAsideActive(2),k.updateChatActive(n),k.updateActiveRoomId(n);let e;C.value===1?e=`/chat/chatsingleroom/${n}?receiveId=${t}`:e=`/chat/chatgrooproom/${n}`,u.push(e)}function oe(n){n.preventDefault(),window.addEventListener("mousemove",E),window.addEventListener("mouseup",T)}function E(n){const t=n.clientX-I.value.getBoundingClientRect().left;t>150&&t<300&&(I.value.style.width=t+"px")}function T(){window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",T)}function P(n,t){n.preventDefault(),h.value=t,s.value&&s.value[0]&&(s.value[0].style.display="block",s.value[0].style.left="0px",s.value[0].style.top=`${n.pageY}px`)}function se(n,t){n.stopPropagation(),v.selectId=t.id,v.username=t.username,v.avatar=t.avatar,t.iconId==9&&ie(t.id),t.iconId==10&&le(t.id,t.username),t.iconId==11&&(_.value=!0),t.iconId==12&&(w.value=!0),O()}async function ae(n,t){n.stopPropagation();const e={roomId:t.roomId,joinId:i.user.info.id,handleId:i.user.info.id},{data:a}=await Ae(e);if(a.code!==200)return alert(a.message);const y=m.value.findIndex(ve=>ve.roomId===t.roomId);m.value.splice(y,1);const N=t.roomId,S=i.user.info.id,U=`${i.user.info.username}退出了群聊`,D=1,de=i.user.info.username,ce=i.user.info.avater,fe=i.user.info.id,me={roomId:N,sendId:S,conment:U,type:D,sendIdUsername:de,sendIdAvatar:ce,deleteId:fe,isChat:!1};J.emit("send_group_chat",me)}function ie(n){s.value[0].style.display="none",u.push(`/user?id=${n}`)}function le(n,t){confirm(`你确定要与${t}解除好友关系吗？如果解除，聊天记录也将会清除`)&&console.log("解除成功"),s.value[0].style.display="none"}async function re(n){_.value=!1,await M(n,i.user.info.id,1),await M(n,v.selectId,3);const t={roomId:n,sendId:i.user.info.id,conment:`${i.user.info.username}加入房间`},e={roomId:n,sendId:v.selectId,conment:`${v.username}加入房间`};await G(t),await G(e)}async function ue(n){if(w.value=!1,await M(n,v.selectId,3)==-1)return;const e=v.selectId,a=`${v.username}加入房间`,y={roomId:n,sendId:e,conment:a},N=1,S=v.username,U=v.avatar,D={roomId:n,sendId:e,conment:a,type:N,sendIdUsername:S,sendIdAvatar:U,isChat:!1,addUser:!0};J.emit("send_group_chat",D),await G(y)}async function M(n,t,e=3){s.value[0].style.display="none";const a={roomId:n,joinId:t,identity:e},{data:y}=await Me(a);if(y.code!==200)return-1}function O(n){s.value&&s.value[0]&&(s.value[0].style.display="none")}async function q(n){if(C.value=n,n===1){const t={id:i.user.info.id},{data:e}=await Y(t),{data:a}=e;e.code===200&&(d.value=a,g.value=d.value);return}if(n===2){const t={joinId:i.user.info.id},{data:e}=await Le(t),{data:a}=e;e.code===200&&(m.value=a,g.value=m.value);return}}return ke(async()=>{const n={id:i.user.info.id},{data:t}=await Y(n),{data:e}=t;t.code===200&&(d.value=e,g.value=d.value)}),we(()=>{document.addEventListener("click",O)}),Ce(()=>{}),(n,t)=>(l(),r("div",{class:"FriendList-container",ref_key:"resizableRef",ref:I},[o("h3",null,[o("span",{class:K({active:C.value===1}),onClick:t[0]||(t[0]=e=>q(1))},"好友",2),t[5]||(t[5]=xe("/ ")),o("span",{class:K({active:C.value===2}),onClick:t[1]||(t[1]=e=>q(2))},"群聊",2)]),o("div",{class:"resizer",ref_key:"resizerRef",ref:f,onMousedown:oe},null,544),o("div",Te,[ee(o("input",{type:"text",name:"search",id:"search",placeholder:"输入昵称","onUpdate:modelValue":t[2]||(t[2]=e=>L.value=e)},null,512),[[te,L.value]]),t[6]||(t[6]=o("div",{class:"icons"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-sousuo"})])],-1))]),g.value.length>0?(l(),r(F,{key:0},[C.value===1?(l(!0),r(F,{key:0},b(g.value,e=>(l(),r("div",{class:"frind hover",key:e.roomId,onClick:a=>j(e.roomId,e.id),onContextmenu:a=>P(a,e.id)},[o("img",{src:e.avatar,alt:"用户头像",title:"用户头像"},null,8,Oe),o("strong",{title:e.username},R(e.username),9,qe),h.value===e.id?(l(),r("div",{key:0,ref_for:!0,ref_key:"customMenuRef",ref:s,id:"customMenu"},[o("ul",null,[(l(!0),r(F,null,b(z(Ie),a=>(l(),r("li",{onClick:y=>se(y,{...a,...e}),key:a.iconId},[o("div",Ke,[(l(),r("svg",We,[o("use",{"xlink:href":a.class},null,8,Xe)]))]),o("span",null,R(a.title),1)],8,He))),128))])],512)):A("",!0)],40,Pe))),128)):(l(!0),r(F,{key:1},b(g.value,e=>(l(),r("div",{class:"group hover",key:e.roomId,onContextmenu:a=>P(a,e.id),onClick:a=>j(e.roomId,e.id)},[o("img",{src:e.avatar,alt:"群聊头像",title:"群聊头像"},null,8,Je),o("strong",{title:e.roomName},R(e.roomName),9,Qe),h.value===e.id?(l(),r("div",{key:0,ref_for:!0,ref_key:"customMenuRef",ref:s,id:"customMenu"},[o("ul",null,[(l(!0),r(F,null,b(z(Fe),a=>(l(),r("li",{onClick:y=>ae(y,{...a,...e}),key:a.iconId},[o("div",et,[(l(),r("svg",tt,[o("use",{"xlink:href":a.class},null,8,nt)]))]),o("span",null,R(a.title),1)],8,Ze))),128))])],512)):A("",!0)],40,Ye))),128))],64)):(l(),V(be,{key:1,class:"no-data"})),(l(),V(X,null,[$(Q,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=e=>_.value=e)},{default:W(()=>[$(Ee,{confirmFn:re})]),_:1},8,["modelValue"])],1024)),(l(),V(X,null,[$(Q,{modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=e=>w.value=e)},{default:W(()=>[$(Ne,{hasConment:!1,confirmFn:ue})]),_:1},8,["modelValue"])],1024))],512))}},st=B(ot,[["__scopeId","data-v-a1919d8d"]]),ft={__name:"FriendView",setup(x){const p=ne();return(i,k)=>{var u,d,m;return(m=(d=(u=z(p))==null?void 0:u.user)==null?void 0:d.info)!=null&&m.id?(l(),V(st,{key:0})):A("",!0)}}};export{ft as default};
