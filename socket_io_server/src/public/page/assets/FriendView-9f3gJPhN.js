import{A as se,r as u,w as O,n as j,o as i,c,B as ae,a as o,f as S,l as q,v as W,C as ie,u as le,g as re,h as ue,i as de,j as ce,d as E,q as fe,F as x,b as L,t as A,e as X,m as $,k as R,D as T,K as P}from"./index-B0xKhKPY.js";import{_ as M,u as Y,g as H,b as me}from"./_plugin-vue_export-helper-C33wAQXg.js";import{N as ve}from"./NoData-BQ9Rgfv8.js";import{u as pe}from"./notify-Dh8hW12u.js";import{u as _e}from"./chat-c1x6M4ub.js";import{f as ge,h as ye,i as N,j as ke}from"./group_chat-BSKifq6B.js";import{A as he}from"./AddRoom-DdXZYx0P.js";const we={__name:"Mask",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(C){const m=se(C,"modelValue"),a=u();function g(l){l.stopPropagation(),m.value=!1}return O(m,(l,r)=>{l===!0&&j(()=>{a.value.style.visibility="visible"}),l===!1&&j(()=>{a.value.style.visibility="hidden"})}),(l,r)=>(i(),c("div",{ref_key:"maskRef",ref:a,class:"mask",onClick:g},[ae(l.$slots,"default",{},()=>[r[0]||(r[0]=o("text",null,"暂无内容",-1))])],512))}},K=M(we,[["__scopeId","data-v-9d877ef1"]]),Ce={class:"form_col file"},be={for:"file",class:"flie_label"},Fe=["src"],xe={class:"form_col"},Re={for:"group_name"},$e={__name:"AddGroupForm",props:{confirmFn:Function},setup(C){const m=u(),a=u(),g=u(null),l=C,r=async()=>{const f=new FormData,s=g.value.files[0];if(!(s&&/^(image\/jpeg|image\/png|image\/gif|image\/bmp|image\/webp)$/.test(s.type))){alert("Valid image file.");return}if(a.length==0){alert("群聊名称不能为空");return}f.append("file",s),f.append("fileName",s.name.split(".")[0]),f.append("timestamp",Date.now()),f.append("roomName",a.value);try{const v=await ge(f),{data:k}=v;l.confirmFn&&l.confirmFn(k.data.roomId),a.value=""}catch(v){console.error("上传失败:",v)}},_=f=>{const s=f.target.files[0],y=new FileReader;y.onload=function(v){const k=v.target.result;m.value=k},y.readAsDataURL(s)},b=f=>{f.stopPropagation()};return(f,s)=>(i(),c("form",{onSubmit:ie(r,["prevent"]),onClick:b},[o("div",Ce,[o("label",be,[s[1]||(s[1]=o("span",null,"上传头像:",-1)),s[2]||(s[2]=o("div",null,[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-shangchuantouxiang"})])],-1)),o("input",{type:"file",name:"file",ref_key:"fileRef",ref:g,id:"file",onChange:_},null,544),m.value?(i(),c("img",{key:0,src:m.value,alt:"预览"},null,8,Fe)):S("",!0)])]),o("div",xe,[o("label",Re,[s[3]||(s[3]=o("span",null,"群聊名称: ",-1)),q(o("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=y=>a.value=y),id:"group_name",name:"group_name",placeholder:"输入群聊名称"},null,512),[[W,a.value]])])]),s[4]||(s[4]=o("div",{class:"form_col submit"},[o("label",{for:"submit"},[o("button",{type:"submit",name:"submit",id:"submit"},"创建")])],-1))],32))}},Ie=M($e,[["__scopeId","data-v-699fb2e7"]]),Ve={class:"search"},Le=["onClick","onContextmenu"],Ae=["src"],Ne=["title"],Se=["onClick"],Me={class:"more_icon"},De={class:"icon","aria-hidden":"true"},Ue=["xlink:href"],ze=["onClick"],Be=["src"],Ge=["title"],je={__name:"FriendList",setup(C){const m=pe(),a=Y(),g=_e(),l=le(),r=u([]),_=u([]),b=u(),f=u(),s=u(null),y=u(),v=u(!1),k=u(!1),h=re({selectId:"",username:""}),w=u(1),I=u(""),p=u([]);O(I,(n,e)=>{n.length===0?w.value===1?p.value=r.value:p.value=_.value:w.value===1?p.value=r.value.filter(t=>t.username.indexOf(n)!==-1):p.value=_.value.filter(t=>t.roomName.indexOf(n)!==-1)});function D(n,e){m.updateAsideActive(2),g.updateChatActive(n),g.updateActiveRoomId(n);let t;w===1?t=`/chat/chatsingleroom/${n}?receiveId=${e}`:t=`/chat/chatgrooproom/${n}`,l.push(t)}function J(n){n.preventDefault(),window.addEventListener("mousemove",U),window.addEventListener("mouseup",z)}function U(n){const e=n.clientX-b.value.getBoundingClientRect().left;e>150&&e<300&&(b.value.style.width=e+"px")}function z(){window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",z)}function Q(n,e){n.preventDefault(),y.value=e,s.value&&s.value[0]&&(s.value[0].style.display="block",s.value[0].style.left="0px",s.value[0].style.top=`${n.pageY}px`)}function Z(n,e){n.stopPropagation(),console.log(e),h.selectId=e.id,h.username=e.username,e.iconId==9&&ee(e.id),e.iconId==10&&te(e.id,e.username),e.iconId==11&&(v.value=!0),e.iconId==12&&(k.value=!0),B()}function ee(n){s.value[0].style.display="none",l.push(`/user?id=${n}`)}function te(n,e){confirm(`你确定要与${e}解除好友关系吗？如果解除，聊天记录也将会清除`)&&console.log("解除成功"),s.value[0].style.display="none"}async function ne(n){v.value=!1,await V(n,a.user.info.id,1),await V(n,h.selectId,3);const e={roomId:n,sendId:a.user.info.id,conment:`${a.user.info.username}加入房间`},t={roomId:n,sendId:h.selectId,conment:`${h.username}加入房间`};await N(e),await N(t)}async function oe(n){k.value=!1,await V(n,h.selectId,3);const e={roomId:n,sendId:h.selectId,conment:`${h.username}加入房间`};await N(e)}async function V(n,e,t=3){s.value[0].style.display="none";const d={roomId:n,joinId:e,identity:t},{data:F}=await ke(d);F.code!==200&&alert(F.message)}function B(n){s.value&&s.value[0]&&(s.value[0].style.display="none")}async function G(n){if(w.value=n,n===1){const e={id:a.user.info.id},{data:t}=await H(e),{data:d}=t;t.code===200&&(r.value=d,p.value=r.value);return}if(n===2){const e={joinId:a.user.info.id},{data:t}=await ye(e),{data:d}=t;t.code===200&&(_.value=d,p.value=_.value);return}}return ue(async()=>{const n={id:a.user.info.id},{data:e}=await H(n),{data:t}=e;e.code===200&&(r.value=t,p.value=r.value)}),de(()=>{document.addEventListener("click",B)}),ce(()=>{}),(n,e)=>(i(),c("div",{class:"FriendList-container",ref_key:"resizableRef",ref:b},[o("h3",null,[o("span",{class:E({active:w.value===1}),onClick:e[0]||(e[0]=t=>G(1))},"好友",2),e[5]||(e[5]=fe("/ ")),o("span",{class:E({active:w.value===2}),onClick:e[1]||(e[1]=t=>G(2))},"群聊",2)]),o("div",{class:"resizer",ref_key:"resizerRef",ref:f,onMousedown:J},null,544),o("div",Ve,[q(o("input",{type:"text",name:"search",id:"search",placeholder:"输入昵称","onUpdate:modelValue":e[2]||(e[2]=t=>I.value=t)},null,512),[[W,I.value]]),e[6]||(e[6]=o("div",{class:"icons"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-sousuo"})])],-1))]),p.value.length>0?(i(),c(x,{key:0},[w.value===1?(i(!0),c(x,{key:0},L(p.value,t=>(i(),c("div",{class:"frind hover",key:t.roomId,onClick:d=>D(t.roomId,t.id),onContextmenu:d=>Q(d,t.id)},[o("img",{src:t.avatar,alt:"用户头像",title:"用户头像"},null,8,Ae),o("strong",{title:t.username},A(t.username),9,Ne),y.value===t.id?(i(),c("div",{key:0,ref_for:!0,ref_key:"customMenuRef",ref:s,id:"customMenu"},[o("ul",null,[(i(!0),c(x,null,L(X(me),d=>(i(),c("li",{onClick:F=>Z(F,{...d,...t}),key:d.iconId},[o("div",Me,[(i(),c("svg",De,[o("use",{"xlink:href":d.class},null,8,Ue)]))]),o("span",null,A(d.title),1)],8,Se))),128))])],512)):S("",!0)],40,Le))),128)):(i(!0),c(x,{key:1},L(p.value,t=>(i(),c("div",{class:"frind hover",key:t.roomId,onClick:d=>D(t.roomId,t.id)},[o("img",{src:t.avatar,alt:"群聊头像",title:"群聊头像"},null,8,Be),o("strong",{title:t.roomName},A(t.roomName),9,Ge)],8,ze))),128))],64)):(i(),$(ve,{key:1,class:"no-data"})),(i(),$(P,null,[R(K,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t)},{default:T(()=>[R(Ie,{confirmFn:ne})]),_:1},8,["modelValue"])],1024)),(i(),$(P,null,[R(K,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t)},{default:T(()=>[R(he,{hasConment:!1,confirmFn:oe})]),_:1},8,["modelValue"])],1024))],512))}},Ee=M(je,[["__scopeId","data-v-fb20ad61"]]),Xe={__name:"FriendView",setup(C){const m=Y();return(a,g)=>{var l,r,_;return(_=(r=(l=X(m))==null?void 0:l.user)==null?void 0:r.info)!=null&&_.id?(i(),$(Ee,{key:0})):S("",!0)}}};export{Xe as default};
