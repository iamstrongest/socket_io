import{r as l,w as V,i as X,n as g,s as Y,c as d,a as o,F as L,b,e as T,x as q,y as z,o as u,t as _,z as K}from"./index-DVw92pm9.js";import{u as $,g as N}from"./chat-BlAwU8ry.js";import{_ as W,u as j,s as G}from"./_plugin-vue_export-helper-DsrsFqtt.js";import{t as J}from"./utilFn-1iToDg8-.js";import"./group_chat-CzpvJGJe.js";const O={class:"chat-tontainer"},Q={key:0,class:"left-chat-info"},Z=["src"],ee={class:"chat-info-common"},te=["title"],se={key:1,class:"right-chat-info"},oe={class:"chat-info-common right-chat-info-div"},ne=["title"],ae=["src"],ie={class:"icons-containers"},ce={class:"icon","aria-hidden":"true"},le=["xlink:href"],re={__name:"ChatSingleRoomView",setup(de){const m=z(),h=j(),c=$(),D=l([]),n=l(),I=l(),w=l(),a=l(),v=l(1),M=l();K("scrollFn",()=>{g(()=>{n.value&&(n.value.scrollTop=n.value.scrollHeight)})});let E,A;const S=[{class:"#icon-biaoqing",id:1,title:"表情包"},{class:"#icon-stationary_file",id:2,title:"发送文件"},{class:"#icon-shipin",id:3,title:"视频通话"},{class:"#icon-gengduox",id:4,title:"更多"}],y=l(!1);V(()=>m.params.roomId,async(s,t)=>{c.resetChatList(),c.updateActiveRoomId(s),v.value=1;const e={roomId:s,page:v.value},i=await R(e);c.addAfterChat(i)});function k(){if(y.value)return;const s=I.value.innerText.trim();if(s.length===0){alert("发送内容不能为空");return}const t=m.params.roomId,e=h.user.info.id,i=new Date;c.updateRoomList({roomId:t,conment:s,createdAt:i});const r=parseInt(m.query.receiveId),f=1,p={roomId:t,sendId:e,conment:s,receiveId:r,type:f,createdAt:i},H=h.user.info.username,P=h.user.info.avatar;c.addAfterChat({conment:s,roomId:t,sendId:e,receiveId:r,type:f,sendIdUsername:H,sendIdAvatar:P}),G.emit("send_single_chat",p),g(()=>{I.value.innerText="",n.value.scrollTop=n.value.scrollHeight})}async function R(s){const{data:t}=await N(s),{data:e}=t;return M.value=t.totalPage,e.length==0&&alert(t.message),v.value<M.value&&v.value++,e}async function U(s){var t;if(((t=s.target)==null?void 0:t.scrollTop)<10){const i={roomId:m.params.roomId,page:v.value},r=await R(i);c.addBeforeChat(r)}}const F=J(U,500);X(async()=>{const s=m.params.roomId;c.updateActiveRoomId(s);const t={roomId:s,page:v.value},e=await R(t);D.value=e,c.addAfterChat(e),g(()=>{n.value&&(n.value.addEventListener("scroll",F),a.value.addEventListener("mousedown",B),n.value.scrollTop=n.value.scrollHeight)})});function B(s){var t,e;s.preventDefault(),s.stopPropagation(),E=s.clientX-((t=a.value)==null?void 0:t.getBoundingClientRect().left),A=s.clientY-((e=a.value)==null?void 0:e.getBoundingClientRect().top),document.addEventListener("mousemove",C),document.addEventListener("mouseup",x)}function C(s){var r,f,p;y.value=!0;const t=(r=w.value)==null?void 0:r.getBoundingClientRect();let e=s.clientX-E-t.left,i=s.clientY-A-t.top;e=Math.max(0,Math.min(e,t.width-((f=a.value)==null?void 0:f.offsetWidth))),i=Math.max(0,Math.min(i,t.height-((p=a.value)==null?void 0:p.offsetHeight))),g(()=>{a.value&&(a.value.style.left=`${e}px`,a.value.style.top=`${i}px`)})}function x(){setTimeout(()=>{y.value=!1},100),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",x)}return Y(()=>{var s,t;(s=n.value)==null||s.removeEventListener("scroll",k),(t=a.value)==null||t.removeEventListener("mousedown",B),document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",x)}),(s,t)=>(u(),d("div",O,[o("div",{class:"chat-message",ref_key:"chatMessageRef",ref:n},[(u(!0),d(L,null,b(T(c).chatList,e=>(u(),d(L,{key:e.roomId},[e.sendId!=T(h).user.info.id?(u(),d("div",Q,[o("div",null,[o("img",{src:e.sendIdAvatar,alt:"头像"},null,8,Z)]),o("div",ee,[o("h3",null,_(e.sendIdUsername),1),o("p",{class:"conment",title:e.conment},_(e.conment),9,te)])])):(u(),d("div",se,[o("div",oe,[o("h3",null,_(e.sendIdUsername),1),o("p",{class:"conment",title:e.conment},_(e.conment),9,ne)]),o("div",null,[o("img",{src:e.sendIdAvatar,alt:"头像"},null,8,ae)])]))],64))),128))],512),o("div",{class:"send-container",ref_key:"sendContainerRef",ref:w},[o("div",ie,[(u(),d(L,null,b(S,e=>o("div",{class:"icons",key:e.id,title:"功能未开发"},[(u(),d("svg",ce,[o("use",{"xlink:href":e.class},null,8,le)]))])),64))]),o("div",{class:"input-tontainer",contenteditable:"true",ref_key:"editableDivRef",ref:I,onKeydown:q(k,["enter"])},null,544),o("div",{class:"send-btns .tuozhuai",ref_key:"sendBtnsRef",ref:a,onClick:k,title:"可在输入框内拖拽"},t[0]||(t[0]=[o("div",{class:"svg"},[o("svg",{class:"icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-fasong"})])],-1),o("button",{type:"button"},"发送",-1)]),512)],512)]))}},pe=W(re,[["__scopeId","data-v-f40fd918"]]);export{pe as default};
